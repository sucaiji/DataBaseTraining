<!DOCTYPE HTML>
<html>
<head>
    <link href="css/style.css" type="text/css" rel="stylesheet">
</head>
<body>
<b><p>转自http://yinxiangbing.iteye.com/blog/673768</p>
</b><span><strong>1 定义&nbsp;</strong><br/>&nbsp;&nbsp;&nbsp; 数据完整性用于保证数据库中数据的正确性、一致性和可靠性。&nbsp;<br/><strong>2 &nbsp;&nbsp; 类型&nbsp;</strong><br/>· 实体完整性(Entity Integrity)&nbsp;<br/>· 域完整性(Domain Integrity)&nbsp;<br/>· 参照完整性(Referential Integrity)&nbsp;<br/>· 用户定义完整性(User-defined Integrity)&nbsp;<br/>· 图示&nbsp;<br/><br/><strong>实体完整性（Entity Integrity）&nbsp;</strong><br/></span><span></span>
<p><span>实体完整性用于保证<a href="http://lib.csdn.net/base/mysql" class="replace_word" title="MySQL知识库"
                     target="_blank">数据库</a>中数据表的每一个特定实体的记录都是唯一的 。</span>
</p>
<p><span>&nbsp;&nbsp;约束种类&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 功能描述<br/>&nbsp;&nbsp;PRIMARY KEY(主键)约束&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 唯一识别每一条记录的标志，可以有多列共同组成<br/>&nbsp;&nbsp;IDENTITY(自增)约束&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 列值自增，一般使用此属性设置的列作为主键<br/>&nbsp;&nbsp;UNIQUE(唯一)约束&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可以使用UNIQUE约束确保在非主键列中不存在重复值，但列值可以是NULL(空)<br/></span>
</p><span><strong>域完整性（Domain Integrity）&nbsp;</strong><br/></span><span></span>
<p><span>域完整性是指保证指定列的数据具有正确的数据类型、格式和有效的数据范围。&nbsp;</span></p>
<p><span>&nbsp;&nbsp;CHECK(检查)约束&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 用于限制列中值得范围<br/>&nbsp;&nbsp;FOREIGN KEY(外键)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一个表中的FORENIGN KEY 指向另一个表中的PRIMARY KEY<br/>&nbsp;&nbsp;DEFAULT(默认值)约束&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 用于向列中插入默认值<br/>&nbsp;&nbsp;NOT NULL(非空)约束&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 用于强制列不接受NULL(空)值<br/></span>
</p>
<span><strong>参照完整性（Referential Integrity）&nbsp;</strong><br/>当增加、修改或删除数据库表中记录时，可以借助参照完整性来保证相关联表之间数据的一致性 。<br/><strong>用户定义完整性 （User- defined Integrity）&nbsp;</strong><br/></span><span></span>
<p><span>这是由用户定义的完整性。用户定义完整性可以定义不属于其他任何完整性分类的特定业务规则 。</span></p>
<p><span><strong>注意：</strong><br/>1、PRIMARY KEY用于将表中的某类设置为主键，一张表中只有一个主键，主键可以是一列或由多列组成。<br/>2、NOT NULL是对列值进行限制，即在表中添加数据时不允许有NULL值。<br/>3、CHECK约束的语法规则：CHECK(表达式)<br/>外键的使用：字段名 数据类型 [FOREIGN KEY] REFERENCES 表名(字段名)&nbsp;<br/></span>
</p>
<p><span>===================================</span></p>
<p><strong><span>3 数据完整性的实现方式&nbsp;</span></strong></p>
<p><strong><span><br/></span></strong></p>
<span>声明数据完整性和过程数据完整性&nbsp;<br/>(1)使用IDENTITY(标识符)列&nbsp;<br/>语法格式：&nbsp;<br/>CREATE TABEL 数据表名&nbsp;<br/>(列名 列数据类型&nbsp;<strong>IDENTITY&nbsp;</strong>[(<strong>种子</strong>,&nbsp;<strong>增量</strong>)] [，…])&nbsp;<br/>说明：标识种子为标识列的起始值，标识递增量为每次增加的数，二者的默认值均为1。&nbsp;<br/>(2)使用IDENTITY函数&nbsp;<br/>语法格式：&nbsp;<br/>IDENTITY ( 数据类型 [ , 种子 , 递增量 ] ) AS 列名&nbsp;<br/>说明：只用在带有 INTO table 子句的 SELECT 语句中，可以将标识列插入到新表中。&nbsp;<br/>尽管类似，但是 IDENTITY 函数不是与 CREATE TABLE 和 ALTER TABLE 一起使用的 IDENTITY 属性。&nbsp;<br/><br/>完整性类型 约束类型 描述&nbsp;<br/>域 DEFAULT 指定列的默认值&nbsp;<br/>CHECK 指定列的允许值&nbsp;<br/>FOREIGN KEY 指定必须存在值的列&nbsp;<br/>NULL 指定是否允许为NULL&nbsp;<br/>实体 PRIMARY KEY 唯一标识每一行&nbsp;<br/>UNIQUE 防止非主键重复&nbsp;<br/>引用 FOREIGN KEY 定义值与同一个表或另一个表的主键值匹配的一列或多列组合&nbsp;<br/>CHECK 指定根据同一个表中其他列的值可在列中接受的数据值&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>在SQL SERVER中，对于基本表的约束分为列约束和表约束。&nbsp;<br/>完整性约束的基本语法格式为：&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [CONSTRAINT constraint_name（约束名）] &lt;约束类型&gt;&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 约束不指定名称时，系统会给定一个名称。&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在SQL Server 2005中有6种约束：主键约束（primary key constraint）、惟一性约束（unique constraint）、检查约束（check constraint）、默认约束（default constraint）、外部键约束（foreign key constraint）和空值（NULL）约束。&nbsp;<br/>PRIMARY KEY 约束&nbsp;<br/>PRIMARY KEY约束用于定义基本表的主键，它是惟一确定表中每一条记录的标识符，其值不能为NULL，也不能重复，以此来保证实体的完整性。PRIMARY KEY与UNIQUE约束类似，通过建立唯一索引来保证基本表在主键列取值的唯一性，但它们之间存在着很大的区别：&nbsp;<br/>①一个表只能有一个 PRIMARY KEY 约束 ，但可定义多个UNIQUE约束；&nbsp;<br/>②对于指定为PRIMARY KEY的一个列或多个列的组合，其中任何一个列都不能出现空值，而对于UNIQUE所约束的唯一键，则允许为空。&nbsp;<br/>注意：不能为同一个列或一组列既定义UNIQUE约束，又定义PRIMARY KEY约束；&nbsp;<br/>PRIMARY KEY既可用于列约束，也可用于表约束。&nbsp;<br/>（2）使用Transact-SQL语句操作法设置主键约束，其语法形式如下：&nbsp;<br/>&nbsp;&nbsp; PRIMARY&nbsp; KEY&nbsp;&nbsp;<br/>&nbsp;&nbsp; CONSTRAINT&nbsp; constraint_name&nbsp; PRIMARY&nbsp; KEY&nbsp; （ column_name ）&nbsp;<br/>举例：建立一个SC表，定义SNO，CNO共同组成SC的主键&nbsp;<br/>程序清单如下：&nbsp;<br/>create table sc(&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp; sno char(5) not null,&nbsp;<br/>cno char(5) not null,&nbsp;<br/>score numeric (3),&nbsp;<br/>constraint sc_prim primary key(sno,cno)&nbsp;<br/>)&nbsp;<br/>UNIQUE约束&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 惟一性约束用于指定一个或者多个列的组合值具有惟一性，以防止在列中输入重复的值。定义了UNIQUE约束的那些列称为唯一键，系统自动为唯一键建立唯一索引，从而保证了唯一键的唯一性。&nbsp;<br/>当使用惟一性约束时，需要考虑以下几个因素：&nbsp;<br/>· 使用惟一性约束的字段允许为空值；&nbsp;<br/>· 一个表中可以允许有多个惟一性约束；&nbsp;<br/>· 可以把惟一性约束定义在多个字段上；&nbsp;<br/>· 惟一性约束用于强制在指定字段上创建一个惟一性索引；&nbsp;<br/>· 默认情况下，创建的索引类型为非聚集索引。&nbsp;<br/>使用Transact-SQL语句完成惟一性约束的操作，其语法形式如下：&nbsp;<br/>· &nbsp;&nbsp;&nbsp; UNIQUE&nbsp;<br/>· &nbsp;&nbsp;&nbsp; CONSTRAINT&nbsp; constraint_name UNIQUE （ column_name ）&nbsp;<br/>CHECK 约束&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 检查约束对输入列或者整个表中的值设置检查条件，以限制输入值，保证数据库数据的完整性。&nbsp;<br/>当使用检查约束时，应该考虑和注意以下几点：&nbsp;<br/>· 一个列级检查约束只能与限制的字段有关；一个表级检查约束只能与限制的表中字段有关；&nbsp;<br/>· 一个表中可以定义多个检查约束；&nbsp;<br/>· 每个CREATE TABLE语句中每个字段只能定义一个检查约束；&nbsp;<br/>· 在多个字段上定义检查约束，则必须将检查约束定义为表级约束；&nbsp;<br/>· 当执行INSERT语句或者UPDATE语句时，检查约束将验证数据；&nbsp;<br/>· 检查约束中不能包含子查询。&nbsp;<br/>用Transact-SQL语句创建检查约束。其语法形式如下：&nbsp;<br/>· &nbsp;&nbsp; CONSTRAINT&nbsp; constraint_name&nbsp; CHECK&nbsp; （logical_expression）&nbsp;<br/>· &nbsp;&nbsp; CHECK&nbsp; （logical_expression）&nbsp;<br/>create table sc(&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp; sno char(5) not null,&nbsp;<br/>cno char(5) not null,&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp; score numeric(5,1) constraint score_chk check(score&gt;=0 and score &lt;=100),&nbsp;<br/>constraint sc_prim primary key(sno,cno),&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>)&nbsp;<br/>drop table sc&nbsp;<br/>insert into sc values('1','2',3)&nbsp;<br/>DEFAULT 约束&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 默认约束指定在插入操作中如果没有提供输入值时，则系统自动指定值。默认约束可以包括常量、函数、不带变元的内建函数或者空值。&nbsp;<br/>使用默认约束时，应该注意以下几点：&nbsp;<br/>（1）每个字段只能定义一个默认约束；&nbsp;<br/>（2）如果定义的默认值长于其对应字段的允许长度，那么输入到表中的默认值将被截断；&nbsp;<br/>（3）不能加入到带有IDENTITY属性或者数据类型为timestamp的字段上；&nbsp;<br/>（4）如果字段定义为用户定义的数据类型，而且有一个默认绑定到这个数据类型上，则不允许该字段有默认约束。&nbsp;<br/>创建默认约束的Transact-SQL语句操作法。其语法形式如下：&nbsp;<br/>· &nbsp;&nbsp;&nbsp; CONSTRAINT&nbsp; constraint_name&nbsp; DEFAULT&nbsp; constraint_expression&nbsp; [FOR&nbsp; column_name]&nbsp;<br/>· &nbsp;&nbsp;&nbsp;&nbsp; DEFAULT&nbsp; constraint_expression&nbsp; [FOR&nbsp; column_name]&nbsp;<br/>举例：为 dept字段创建默认约束。&nbsp;<br/>程序清单如下：&nbsp;<br/>constraint&nbsp; con_dept&nbsp; default&nbsp; ‘计算机’&nbsp; for&nbsp; dept&nbsp;<br/>NULL 约束&nbsp;<br/>空值约束用来控制是否允许该字段的值为NULL。NULL值不是0也不是空白，更不是填入字符串的“NULL”字符串，而是表示“不知道”、“ 不确定”或“没有数据”的意思。&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 当某一字段的值一定要输入才有意义的时候，则可以设置为NOT NULL。如主键列就不允许出现空值，否则就失去了唯一标识一条记录的作用。空值约束只能用于定义列约束。&nbsp;<br/>FOREIGN KEY 约束&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp; FOREIGN KEY约束是用于建立和加强两个表数据之间的链接的一列或多列。外部键约束用于强制参照完整性。&nbsp;<br/><br/>FOREIGN KEY 约束确保同一个表或者不同表之间的引用完整性&nbsp;<br/>必须引用一个PRIMARY KEY或者UNIQUE约束&nbsp;<br/>用户必须在应用表上具有REFERENCES权限&nbsp;<br/>一个表中最多可以有31个外部键约束；&nbsp;<br/>在临时表中，不能使用外部键约束；&nbsp;<br/>主键和外部键的数据类型必须严格匹配 。&nbsp;<br/><br/>使用Transact-SQL语句设置外部键约束 ，其语法形式如下：&nbsp;<br/>&nbsp; CONSTRAINT&nbsp; constraint_name&nbsp;<br/>&nbsp; FOREIGN&nbsp; KEY&nbsp; （column_name[,…n]）&nbsp;<br/>&nbsp; REFERENCES&nbsp; ref_table&nbsp; [（ref_column[,…n]）]&nbsp;<br/>ALTER TABLE [Sales].[SalesOrderHeader]&nbsp; WITH CHECK&nbsp;<br/>ADD CONSTRAINT [FK_SalesOrderHeader_Customer_CustomerID]&nbsp;<br/>FOREIGN KEY([CustomerID])&nbsp;<br/>REFERENCES [Sales].[Customer] ([CustomerID])&nbsp;<br/>禁用 CHECK 和 FOREIGN KEY 约束:&nbsp;<br/>· 当运行大型批处理作业时提高性能&nbsp;<br/></span><span></span>
<p><span>· 当向表中添加新的约束的时候避免检查已经存在的数据&nbsp;</span></p>
<p><span>=============================</span></p>
<p><span>必须会的SQL语句：数据库的完整性约束&nbsp;<br/><span><span><span>实体完整性</span></span></span></span></p>
<div><span><span><br/></span></span></div>
<div><span><span><span><span>1.建表时定义主键</span></span></span></span></div>
<div><span><span><span>&nbsp; Create table 表名</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; (</span></span></span></div>
<div>
    <span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sno int identity(1,1),</span></span></span>
</div>
<div><span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sname nvarchar(20),</span></span></span>
</div>
<div><span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --设置主键</span></span></span></div>
<div>
    <span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Primary key (Sno)</span></span></span>
</div>
<div><span><span><span>&nbsp;&nbsp; )</span></span></span></div>
<div></div>
<div><span><span><span>2.添加主键</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp;&nbsp; alter table 表名</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp;&nbsp; add constraint PK_表名_Sno</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp;&nbsp; primary key(id)</span></span></span></div>
<div></div>
<div><span><span><span><span>参照完整性</span></span></span></span></div>
<div></div>
<div><span><span><span>1.建表时定义外键</span></span></span></div>
<div><span><span><span>&nbsp; create table 表名</span></span></span></div>
<div><span><span><span>&nbsp; (</span></span></span></div>
<div>
    <span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sno int identity(1,1) primary key,</span></span></span>
</div>
<div><span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cno int not null,</span></span></span></div>
<div>
    <span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreign key(cno) References</span></span></span>
</div>
<div><span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 表名2(Cno)</span></span></span></div>
<div>
    <span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on Delete cascade&nbsp;&nbsp;&nbsp;&nbsp;<span>&nbsp;</span></span><span><span>--级联删除</span></span></span></span>
</div>
<div>
    <span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on update cascade&nbsp;&nbsp;&nbsp;&nbsp;</span><span><span>--级联更新</span></span></span></span>
</div>
<div>
    <span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- on delete on action&nbsp; 删除管制</span></span></span>
</div>
<div><span><span><span>&nbsp; )</span></span></span></div>
<div></div>
<div><span><span><span>2.添加外键</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; alter table 表名</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; add constraint FK_表名_表名2</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; Foreign key(cid) references 表名2(cid)</span></span></span></div>
<div></div>
<div><span><span><span><span>用户定义完整性</span></span></span></span></div>
<div></div>
<div><span><span><span>1.非空约束</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; alter table 表名</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; alter column name varchar(20) not null</span></span></span>
</div>
<div></div>
<div><span><span><span>2.唯一约束</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; alter table 表名</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; add constraint UQ_表名_列名 unique(列)</span></span></span></div>
<div></div>
<div><span><span><span>3.检查约束</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; alter table 表名</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; add constraint CK_表名_列名 check(age&gt;5)</span></span></span>
</div>
<div></div>
<div><span><span><span>4.默认约束</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; alter table 表名</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; add constraint DF_表名_列名 default('男')</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; for gender</span></span></span></div>
<div></div>
<div><span><span><span><span>删除约束</span></span></span></span></div>
<div><span><span><span>&nbsp;&nbsp;&nbsp; --删除约束</span></span></span></div>
<div><span><span><span>&nbsp;&nbsp; alter table 表名 drop constraint DF_表名_列</span></span></span>
</div>
</body>
</html>